{
	"$schema": "http://json-schema.org/schema#",
	"$id": "http://iiif.io/api/presentation/ns/schema-manifest.json",
	"title": "Manifest validation schema",
	"type": "object",
	"properties": {
		"@context": {"type": "array", "items": {"type": "string", "format": "uri"}},
		"id": {"type": "string", "format": "uri"},
		"type": {"type": "string", "enum": ["Manifest"]},
		"label": {"$ref": "#/definitions/languageMap"},
		"metadata": {"type": "array", "items": {"$ref": "#/definitions/metadataItem"}},
		"summary": {"$ref": "#/definitions/languageMap"},
		"requiredStatement": {"$ref": "#/definitions/metadataItem"},
		"thumbnail": {"type": "array", "items": {"$ref": "#/definitions/externalResource"}},
		"posterCanvas": {"$ref": "#/definitions/canvas"},
		"viewingDirection": {"$ref": "#/definitions/viewingDirection"},
		"behavior": {"type": "array", "items": {"$ref": "#/definitions/behaviorItems"}},
		"navDate": {"type": "string", "format": "date-time"},
		"rights": {"type": "string", "format": "uri"},
		"logo": {"type": "array", "items": {"$ref": "#/definitions/externalResource"}},
		"homepage": {"$ref": "#/definitions/externalResource"},
		"service": {"type": "array", "items": {"$ref": "#/definitions/service"}},
		"rendering": {"type": "array", "items": {"$ref": "#/definitions/externalResource"}},
		"partOf": {"type": "array", "items": {"$ref": "#/definitions/externalResource"}},
		"seeAlso": {"type": "array", "items": {"$ref": "#/definitions/externalResource"}},
		"start": {"anyOf": [
				{"$ref": "#/definitions/canvasRef"}, 
				{"$ref": "#/definitions/specificResource"}
			]
		},
		"items": {"type": "array", "items": {"$ref": "#/definitions/canvas"}},
		"structures": {"type": "array", "items": {"$ref": "#/definitions/range"}},
		"annotations": {"type": "array", "items": {"$ref": "#/definitions/annotationPage"}}
	},

	"definitions": {
		"languageMap": {
			"type": "object",
			"patternProperties": {
				"^([a-z]{2,3}(-[a-zA-Z]+)?|@none)$": { 
					"type": "array", "items": {"type": "string"}}
			},
			"additionalProperties": false
		},
		"metadataItem": {
			"type": "object",
			"properties": {
				"label": {"$ref": "#/definitions/languageMap"},
				"value": {"$ref": "#/definitions/languageMap"}
			},
			"additionalProperties": false,
			"required": ["label", "value"]
		},
		"externalResource": {
			"type": "object",
			"properties": {
				"id": {"type": "string", "format": "uri"},
				"type": {"type": "string"},
				"label": {"$ref": "#/definitions/languageMap"},				
				"format": {"type": "string"},
				"service": {"type": "array", "items": {"$ref": "#/definitions/service"}},
				"language": {"type": "array", "items": {"type": "string"}},
				"height": {"type": "integer", "minimum": 1},
				"width": {"type": "integer", "minimum": 1},
				"duration": {"type": "number", "minimum": 1}
			},
			"required": ["id", "type"],
			"dependencies": {
				"width": ["height"],
				"height": ["width"]
			}
		},
		"service": {
			"type": "object",
			"properties": {
				"id": {"type": "string", "format": "uri"},
				"type": {"type": "string"},
				"@id": {"type": "string", "format": "uri"},
				"@type": {"type": "string"},
				"profile": {"type": "string"}
			},
			"anyOf": [
				{"required": ["id", "type"]},
				{"required": ["@id", "@type"]}
			]
		},
		"viewingDirection": {
			"type": "string", 
			"enum": ["right-to-left", "left-to-right", 
					"top-to-bottom", "bottom-to-top"]
		},
		"behaviorItems": {
			"type": "string",
			"enum": ["auto-advance", "continuous", "facing-pages", 
					"individuals", "multi-part", "no-nav", "non-paged",
					"hidden", "paged", "repeat", "sequence",
					"thumbnail-nav", "together", "unordered"]
		},
		"canvasRef": {
			"type": "object",
			"properties": {
				"id": {"type": "string", "format": "uri"},
				"type": {"type": "string", "enum": ["Canvas"]}	
			},
			"required": ["id", "type"]
		},
		"specificResource": {
			"type": "object",
			"properties": {
				"id": {"type": "string", "format": "uri"},
				"type": {"type": "string", "enum": ["SpecificResource"]},
				"source": {"type": "string", "format": "uri"},
				"selector": {"type": "object"}
			}
		},

		"annotationPage": {
			"type": "object",
			"properties": {
				"id": {"type": "string", "format": "uri"},
				"type": {"type": "string", "enum": ["AnnotationPage"]},	
				"label": {"type": "string"},
				"items": {"type": "array", "items": {"$ref": "#/definitions/annotation"}},

				"metadata": {"type": "array", "items": {"$ref": "#/definitions/metadataItem"}},
				"summary": {"$ref": "#/definitions/languageMap"},
				"requiredStatement": {"$ref": "#/definitions/metadataItem"},
				"thumbnail": {"type": "array", "items": {"$ref": "#/definitions/externalResource"}},
				"behavior": {"type": "array", "items": {"$ref": "#/definitions/behaviorItems"}},
				"rights": {"type": "string", "format": "uri"},
				"logo": {"type": "array", "items": {"$ref": "#/definitions/externalResource"}},
				"homepage": {"$ref": "#/definitions/externalResource"},
				"service": {"type": "array", "items": {"$ref": "#/definitions/service"}},
				"rendering": {"type": "array", "items": {"$ref": "#/definitions/externalResource"}},
				"partOf": {"type": "array", "items": {"$ref": "#/definitions/externalResource"}},
				"seeAlso": {"type": "array", "items": {"$ref": "#/definitions/externalResource"}}
			},
			"required": ["id", "type", "items"]

		},

		"range": {
			"type": "object",
			"properties": {
				"id": {"type": "string", "format": "uri"},
				"type": {"type": "string", "enum": ["Range"]}
			},
			"required": ["id", "type"]
		},

		"canvas": {
			"type": "object",
			"properties": {
				"id": {"type": "string", "format": "uri"},
				"type": {"type": "string", "enum": ["Canvas"]},
				"label": {"$ref": "#/definitions/languageMap"},
				"height": {"type": "integer", "minimum": 1},
				"width": {"type": "integer", "minimum": 1},
				"duration": {"type": "number", "minimum": 1},
				"items": {"type": "array", "items": {"$ref": "#/definitions/annotationPage"}},

				"metadata": {"type": "array", "items": {"$ref": "#/definitions/metadataItem"}},
				"summary": {"$ref": "#/definitions/languageMap"},
				"requiredStatement": {"$ref": "#/definitions/metadataItem"},
				"thumbnail": {"type": "array", "items": {"$ref": "#/definitions/externalResource"}},
				"posterCanvas": {"$ref": "#/definitions/canvas"},
				"behavior": {"type": "array", "items": {"$ref": "#/definitions/behaviorItems"}},
				"navDate": {"type": "string", "format": "date-time"},
				"rights": {"type": "string", "format": "uri"},
				"logo": {"type": "array", "items": {"$ref": "#/definitions/externalResource"}},
				"homepage": {"$ref": "#/definitions/externalResource"},
				"service": {"type": "array", "items": {"$ref": "#/definitions/service"}},
				"rendering": {"type": "array", "items": {"$ref": "#/definitions/externalResource"}},
				"partOf": {"type": "array", "items": {"$ref": "#/definitions/externalResource"}},
				"seeAlso": {"type": "array", "items": {"$ref": "#/definitions/externalResource"}},
				"annotations": {"type": "array", "items": {"$ref": "#/definitions/annotationPage"}}
			},
			"required": ["id", "type"],
			"dependencies": {
				"width": ["height"],
				"height": ["width"]
			},
			"anyOf": [
					{"required": ["height", "width"]},
					{"required": ["duration"]}
			] 
		},

		"annotation": {
			"type": "object",
			"properties": {
				"id": {},
				"type": {}
			}
		}

	},
	"additionalProperties": true,
	"required": ["@context", "id", "type", "items"]
}
